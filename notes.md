ссылка должна проверять, что не изменился тип и идентификатор корня

значение (состояние) должно проверять свою целостность


довабить dir-locals.el и положить туда конфигурацию отсупов для cider


в storage нет механизма блокировок.


можно сделать `(get-many t type ids :for-update)`
потом ставить мета-тег, на идентичность?
и при обновлении проверять, что можно обновлять эту идентичность
Т.е. отлавливать эту ошибку в тестах.

Тут приколы возникнут, если сначала без for-update вычитали,
а потом с ним. Т.е. сущность уже есть в кэше.

По идее нужно перечитать сущность и обновить кэш.




уровень изоляции - деталь реализации.
нужна еще одна абстракция - ридонли тразнакция.
Запросы принимают транзакцию.

а storage имеет api:
`(query t query-fn q-arg)`

или
```
(read-only t
  (query-fn t arg))
```


уникальность только для корней.
при этом нет никаких условий.
Т.е. указывается только множество уникальных полей.

Валидация отделена от изменений.
Можно добавить валидатор к рефу при желании?

Запросы могут работать и вне транзакций.
Нужно просто сделать получение коннекта удобно.
Если транзакции нет, то просто соединение.
Если внутри транзакции, то flush, а потом соединение.
